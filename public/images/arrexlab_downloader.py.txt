#!/usr/bin/env python3
Import requests
Import os
Import csv
Import time
Import re
From pathlib import Path
From datetime import datetime

## Configuration
BASE_URL = “https://arrexlab.it/downloads/Download”
API_BASE = “https://api.arrexlab.it”
OUTPUT_DIR = “ARREXLAB_PHOTOS”

# Define all sections
SECTIONS = {
    “FOTO_PER_INTERNET”: {
        “FOTO_MODELLI_ANTA_LISCIA”: “Download/FOTO/FOTO+PER+INTERNET/FOTO+MODELLI+ANTA+LISCIA”,
        “FOTO_MODELLI_ANTA_TELAIO”: “Download/FOTO/FOTO+PER+INTERNET/FOTO+MODELLI+ANTA+TELAIO”
    },
    “FOTO_ALTA_RISOLUZIONE”: {
        “FOTO_MODELLI_ANTA_LISCIA”: “Download/FOTO/FOTO+ALTA+RISOLUZIONE/FOTO+MODELLI+ANTA+LISCIA”,
        “FOTO_MODELLI_ANTA_TELAIO”: “Download/FOTO/FOTO+ALTA+RISOLUZIONE/FOTO+MODELLI+ANTA+TELAIO”
    },
    “FOTO_SPECIALE_ANTE_TELAIO”: {
        “Default”: “Download/FOTO/FOTO+SPECIALE+ANTE+TELAIO”
    },
    “FOTO_SPECIALE_SUPERMATT”: {
        “Default”: “Download/FOTO/FOTO+SPECIALE+SUPERMATT”
    },
    “FOTO_REPORTAGE_SALONE_2024”: {
        “Default”: “Download/FOTO/FOTO+REPORTAGE+SALONE_2024”
    },
    “FOTO_OUTDOOR_COLLECTIONS”: {
        “Default”: “Download/FOTO/FOTO+OUTDOOR+COLLECTIONS”
    },
    “FOTO_SPECIALE_PANTONE025”: {
        “Default”: “Download/FOTO/FOTO+SPECIALE+PANTONE025”
    }
}

Class ArrexLabDownloader:
    Def __init__(self):
        Self.session = requests.Session()
        self.session.headers.update({
            ‘User-Agent’: ‘Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36’
        })
        Self.downloaded = []
        Self.failed = []

    Def create_folders(self):
        Path(OUTPUT_DIR).mkdir(exist_ok=True)
        For section, subsections in SECTIONS.items():
            For subsection in subsections.keys():
                If subsection != “default”:
                    Path(OUTPUT_DIR, section, subsection).mkdir(parents=True, exist_ok=True)
                    print(f”✓ {section}/{subsection}”)
                Else:
                    Path(OUTPUT_DIR, section).mkdir(parents=True, exist_ok=True)
                    print(f”✓ {section}”)

    Def extract_images(self, section, subsection, url_path):
        Try:
            Url = f”{BASE_URL}?search={url_path}”
            print(f”\n→ {section} > {subsection}”)
            Response = self.session.get(url, timeout=30)
            
            Pattern = r’https://api\.arrexlab\.it/dati/img/dwn/glo/mini_file/([^”]+?)\.jpg’
            Matches = re.findall(pattern, response.text)
            
            Images = []
            For filename in matches:
                Download_url = f”{API_BASE}/dati/img/dwn/glo/file/{filename}.jpg”
                images.append({
                    ‘Filename’: filename,
                    ‘Url’: download_url,
                    ‘Section’: section,
                    ‘Subsection’: subsection
                })
            
            print(f”  Found: {len(images)} images”)
            Return images
        Except Exception as e:
            print(f”  Error: {e}”)
            Return []

    Def download_image(self, image, folder):
        Filename = image[‘filename’] + ‘.jpg’
        Filepath = Path(folder) / filename
        
        If filepath.exists():
            Return True
        
        Try:
            Response = self.session.get(image[‘url’], timeout=30, stream=True)
            response.raise_for_status()
            
            With open(filepath, ‘wb’) as f:
                For chunk in response.iter_content(8192):
                    If chunk:
                        f.write(chunk)
            
            Size = filepath.stat().st_size / (1024 * 1024)
            print(f”  ✓ {filename} ({size:.2f}MB)”)
            
            self.downloaded.append({
                ‘Filename’: filename,
                ‘Section’: image[‘section’],
                ‘Subsection’: image[‘subsection’],
                ‘Url’: image[‘url’],
                ‘Size_mb’: round(size, 2),
                ‘Time’: datetime.now().isoformat()
            })
            Return True
        Except Exception as e:
            print(f”  ✗ {filename}: {e}”)
            self.failed.append(filename)
            Return False

    Def save_manifest(self):
        Manifest_file = Path(OUTPUT_DIR) / “MANIFEST.csv”
        With open(manifest_file, ‘w’, newline=’’, encoding=’utf-8’) as f:
            Writer = csv.DictWriter(f, fieldnames=[‘filename’, ‘section’, ‘subsection’, ‘url’, ‘size_mb’, ‘time’])
            writer.writeheader()
            writer.writerows(self.downloaded)
        print(f”\n✓ Manifest: {manifest_file}”)

    Def save_report(self):
        Report_file = Path(OUTPUT_DIR) / “REPORT.txt”
        Total_size = sum(img[‘size_mb’] for img in self.downloaded)
        
        Report = f”””
ARREXLAB DOWNLOAD REPORT
========================
Date: {datetime.now().isoformat()}

STATISTICS:
Downloaded: {len(self.downloaded)}
Failed: {len(self.failed)}
Total Size: {total_size:.2f} MB

BY SECTION:
“””
        Sections_count = {}
        For img in self.downloaded:
            Key = f”{img[‘section’]}/{img[‘subsection’]}”
            Sections_count[key] = sections_count.get(key, 0) + 1
        
        For section, count in sorted(sections_count.items()):
            Report += f”\n{section}: {count} images”
        
        With open(report_file, ‘w’, encoding=’utf-8’) as f:
            f.write(report)
        print(f”✓ Report: {report_file}”)

    Def run(self):
        print(“\n” + “=”*50)
        print(“ARREXLAB DOWNLOADER - STARTED”)
        print(“=”*50)
        
        print(“\nCreating folders…”)
        self.create_folders()
        
        Total = 0
        For section, subsections in SECTIONS.items():
            For subsection, url_path in subsections.items():
                Images = self.extract_images(section, subsection, url_path)
                Total += len(images)
                
                If subsection == “default”:
                    Folder = Path(OUTPUT_DIR) / section
                Else:
                    Folder = Path(OUTPUT_DIR) / section / subsection
                
                For i, image in enumerate(images, 1):
                    print(f”  [{i}/{len(images)}]”, end=” “)
                    self.download_image(image, folder)
                    time.sleep(0.3)
        
        self.save_manifest()
        self.save_report()
        
        print(“\n” + “=”*50)
        print(“✓ COMPLETE!”)
        print(“=”*50)
        print(f”\nTotal images: {len(self.downloaded)}”)
        print(f”Location: {OUTPUT_DIR}/”)
        print(“\nReady for web upload!”)

If __name__ == “__main__”:
    Downloader = ArrexLabDownloader()
    downloader.run()
